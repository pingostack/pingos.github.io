---
title: æ§åˆ¶æ¥å£
permalink: /docs/zh/config-control
key: docs-config-control-zh
---

## é…ç½®

### rtmp_control

*Syntax:* rtmp_control [all] | [record] | [drop] | [redirect] | [pause] | [resume]  
*Default:* -  
*Context:* location

* **Desc**  
    > - all : åœ¨æŒ‡å®šlocationä¸‹å¼€å¯æ‰€æœ‰æ§åˆ¶æ¥å£
    > - record : åœ¨æŒ‡å®šlocationä¸‹åªå¼€å¯å½•åˆ¶æ§åˆ¶æ¥å£
    > - drop : åœ¨æŒ‡å®šlocationä¸‹åªå¼€å¯åœæ­¢æ¥å£
    > - redirect : åœ¨æŒ‡å®šlocationä¸‹åªå¼€å¯é‡å®šå‘æ¥å£
    > - pause : åœ¨æŒ‡å®šlocationä¸‹åªå¼€å¯æš‚åœæ¥å£
    > - resume : åœ¨æŒ‡å®šlocationä¸‹åªå¼€å¯â€œç»§ç»­â€æ¥å£

* **For example**  
  ```nginx
  location /control {
    rtmp_control all;
  }
  ```
  ä¹Ÿå¯å°†æ¯ä¸ªæ§åˆ¶æ¥å£é…ç½®åœ¨ä¸åŒçš„locationä¸‹ï¼š
  ```nginx
  location /drop {
    rtmp_control drop;
  }

  location /record {
    rtmp_control record;
  }

  location /redirect {
    rtmp_control redirect;
  }

  location /pause {
    rtmp_control pause;
  }

  location /resume {
    rtmp_control resume;
  }
  ```

---

## æ§åˆ¶

### æ§åˆ¶æ¥å£çš„æ‹¼å‡‘è§„åˆ™

  ```bash
  http://${your-pingos-server-ip}/control/${section}/${method}?srv=${serverid}&app=${app}&name=${name}&clientid=${clientid}&addr=${addr}
  ```

* **${section}**ï¼šæœ‰5ç§ï¼Œåˆ†åˆ«ä»£è¡¨å¦‚ä¸‹å«ä¹‰  
  > - record : æ§åˆ¶å½•åˆ¶ï¼ˆå¼€å¯/åœæ­¢ï¼‰ã€‚
  > - drop : æ§åˆ¶æ¨æµæˆ–æ‹‰æµä¼šè¯ï¼Œæ–­å¼€è¿æ¥ã€‚
  > - redirect : æ§åˆ¶æ¨æµä¼šè¯æˆ–æ‹‰æµä¼šè¯ï¼Œ1. é‡å‘½åæŸè·¯æ¨æµä¼šè¯ï¼Œå¦‚æœæ–°çš„æµåå·²ç»æœ‰playeræ­£åœ¨æ‹‰æµï¼Œåˆ™playerä¼šæ‹‰å–è¿™ä¸ªé‡å‘½åæˆåŠŸçš„æµå†…å®¹ã€‚2. é‡å‘½åæ‹‰æµä¼šè¯ï¼Œå¦‚æœæ–°çš„æµåå·²ç»æœ‰æ¨æµç«¯åœ¨ç›´æ’­ï¼Œåˆ™è¿™ä¸ªplayerä¼šæ‹‰å–é‡å‘½åæˆåŠŸçš„æµå†…å®¹ã€‚
  > - pause : æ§åˆ¶æ¨æµæˆ–æ‹‰æµä¼šè¯ï¼Œç½‘ç»œè¿æ¥ä¸æ–­çš„æƒ…å†µä¸‹ï¼Œæš‚åœæ¨æµæˆ–æ‹‰æµã€‚
  > - resume : æ§åˆ¶æ¨æµæˆ–æ‹‰æµä¼šè¯ï¼Œæ¢å¤è¢«`pause`çš„ä¼šè¯ã€‚

* **${method}**ï¼š`${section}`ä¸åŒæƒ…å†µä¸‹ï¼Œ`${method}`çš„å¯é€‰ç§ç±»ä¹Ÿä¸åŒï¼Œå…·ä½“å¦‚ä¸‹ï¼š  
  > * å½“`${section}`ä¸ºrecordæ—¶ï¼Œ`${method}`æœ‰å¦‚ä¸‹å–å€¼ï¼š
  >    - start: æ§åˆ¶å¼€å¯å½•åˆ¶
  >    - stop: æ§åˆ¶åœæ­¢å½•åˆ¶
  > * å…¶ä½™æƒ…å†µä¸‹ï¼Œ`${method}`æœ‰å¦‚ä¸‹å–å€¼ï¼š
  > - publisherï¼šé’ˆå¯¹æ¨æµä¼šè¯æ§åˆ¶
  > - subscriberï¼šé’ˆå¯¹æ‹‰æµä¼šè¯æ§åˆ¶
  > - clientï¼šé’ˆå¯¹è¿æ¥æ§åˆ¶ï¼Œå¯ä»¥æ˜¯æ¨æµä¼šè¯ã€ä¹Ÿå¯ä»¥æ˜¯æ‹‰æµä¼šè¯ï¼Œç”¨clientidå‚æ•°åŒºåˆ†ã€‚

**serverid**ã€**app**ã€**name**ï¼šè¿™ä¸‰é¡¹åˆ†åˆ«å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„`serverid`ï¼Œ`application`ä»¥åŠâ€œæµåâ€ï¼ˆstream nameï¼‰ã€‚  
  - å¦‚æœä½ æƒ³å¯¹æŸ`serverid`ä¸‹çš„æ‰€æœ‰ä¼šè¯è¿›è¡Œæ‰¹é‡æ“ä½œï¼Œå¿…é¡»çœç•¥`app`ã€`name`å‚æ•°ã€‚
  - å¦‚æœä½ æƒ³å¯¹æŸ`serverid`çš„æŒ‡å®š`app`ä¸‹çš„æ‰€æœ‰ä¼šè¯è¿›è¡Œæ‰¹é‡æ“ä½œï¼Œåˆ™å¿…é¡»çœç•¥`name`å‚æ•°ã€‚
  - å¦‚æœä½ æƒ³å¯¹æŸè·¯æµçš„æ‰€æœ‰æ‹‰æµä¼šè¯è¿›è¡Œæ§åˆ¶ï¼Œåˆ™å¿…é¡»åŒæ—¶æŒ‡å®š`serverid`ã€`app`å’Œ`name`å‚æ•°ã€‚
  - å¦‚æœä½ æƒ³ç²¾ç¡®æ§åˆ¶æŸæ¨æµä¼šè¯ï¼Œåˆ™å¿…é¡»åŒæ—¶æŒ‡å®š`serverid`ã€`app`å’Œ`name`å‚æ•°ã€‚
  - å¦‚æœä½ æƒ³ç²¾ç¡®æ§åˆ¶æŸæ‹‰æµä¼šè¯ï¼Œåˆ™å¿…é¡»åŒæ—¶æŒ‡å®š`serverid`ã€`app`å’Œ`clientid`ï¼ˆåœ¨on_playäº‹ä»¶é€šçŸ¥ä¸­è·å–ï¼‰å‚æ•°ã€‚
  - å¦‚æœä½ å¸Œæœ›åªæ§åˆ¶é€šè¿‡æœ¬æœºçš„æŸå—ç½‘å¡çš„ä¼šè¯ï¼Œåˆ™åœ¨ä»¥ä¸Šæƒ…å†µçš„åŸºç¡€ä¸ŠæŒ‡å®š`addr`å‚æ•°ï¼ˆä¾‹å¦‚åªæ§åˆ¶ä»127.0.0.1è¿æ¥è¿›æ¥çš„ä¼šè¯ï¼ŒæŒ‡å®š`addr=127.0.0.1`å³å¯ï¼‰ã€‚

### ç¤ºä¾‹

**å‡è®¾ä½¿ç”¨å¦‚ä¸‹é…ç½®**
  ```nginx
  rtmp {
    server {
      listen 1935;
      serverid pingos; # éšæ„æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†
      application live {
        live on;
      }
    }
  }
  http {
    server {
      listen 80;
      location /control {
        rtmp_control all;
      }
    }
  }
  ```

**å½•åƒæ§åˆ¶ï¼ˆrecordï¼‰**

* å¼€å¯æµåä¸º`xxx`çš„ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/start?srv=pingos&app=live&name=xxx
  ```

* å…³é—­æµåä¸º`xxx`çš„ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/stop?srv=pingos&app=live&name=xxx
  ```

* å¼€å¯`app`åç§°ä¸º`live`ä¸‹çš„æ‰€æœ‰ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/start?srv=pingos&app=live
  ```

* å…³é—­`app`åç§°ä¸º`live`ä¸‹çš„æ‰€æœ‰ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/stop?srv=pingos&app=live
  ```

* å¼€å¯`serverid`åç§°ä¸º`pingos`ä¸‹çš„æ‰€æœ‰ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/start?srv=pingos
  ```

* å…³é—­`serverid`åç§°ä¸º`pingos`ä¸‹çš„æ‰€æœ‰ç›´æ’­å½•åƒ

  ```bash
  curl http://127.0.0.1/control/record/start?srv=pingos
  ```

---

**æš‚åœæ§åˆ¶ï¼ˆpauseï¼‰**

* æš‚åœæµåä¸º`xxx`çš„æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/pause/publisher?srv=pingos&app=live&name=xxx
  ```

* æš‚åœ`app`åç§°ä¸º`live`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/pause/publisher?srv=pingos&app=live
  ```

* å…³é—­`serverid`åç§°ä¸º`pingos`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/pause/publisher?srv=pingos
  ```

---

**æ¢å¤æ§åˆ¶ï¼ˆresumeï¼‰**

* æ¢å¤æµåä¸º`xxx`çš„æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/resume/publisher?srv=pingos&app=live&name=xxx
  ```

* æ¢å¤`app`åç§°ä¸º`live`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/resume/publisher?srv=pingos&app=live
  ```

* æ¢å¤`serverid`åç§°ä¸º`pingos`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/resume/publisher?srv=pingos
  ```

---

**æ–­å¼€è¿æ¥æ§åˆ¶ï¼ˆdropï¼‰**

* æ–­å¼€æµåä¸º`xxx`çš„æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/drop/publisher?srv=pingos&app=live&name=xxx
  ```

* æ–­å¼€`app`åç§°ä¸º`live`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/drop/publisher?srv=pingos&app=live
  ```

* æ–­å¼€`serverid`åç§°ä¸º`pingos`ä¸‹çš„æ‰€æœ‰æ¨æµä¼šè¯

  ```bash
  curl http://127.0.0.1/control/drop/publisher?srv=pingos
  ```

---

**ç›´æ’­é‡å®šå‘ï¼ˆredirectï¼‰**

* é‡å‘½åæµåä¸º`xxx`çš„æ¨æµä¼šè¯ï¼Œå°†æ¨æµæµå`xxx`é‡å‘½åä¸º`new-xxx`ï¼Œ`ä¸èƒ½å¯¹æ¨æµä¼šè¯æ‰¹é‡æ“ä½œ`{:.error}

  ```bash
  curl http://127.0.0.1/control/redirect/publisher?srv=pingos&app=live&name=xxx&newname=new-xxx
  ```

* é‡å‘½åæµåä¸º`xxx`çš„æ‹‰æµä¼šè¯ï¼Œå°†æ‹‰æµæµå`xxx`é‡å‘½åä¸º`new-xxx`ï¼Œ`å¯ä»¥å¯¹æ‹‰æµä¼šè¯æ‰¹é‡æ“ä½œ`{:.error}

  ```bash
  curl http://127.0.0.1/control/redirect/subscriber?srv=pingos&app=live&name=xxx&newname=new-xxx
  ```
* å°†serveridç­‰äº`pingos`ä¸”appç­‰äº`live`çš„æ‰€æœ‰æ‹‰æµä¼šè¯æ‰¹é‡é‡å‘½åä¸º`new-xxx`ã€‚

  ```bash
  curl http://127.0.0.1/control/redirect/subscriber?srv=pingos&app=live&newname=new-xxx
  ```
* å°†serveridç­‰äº`pingos`çš„æ‰€æœ‰æ‹‰æµä¼šè¯æ‰¹é‡é‡å‘½åä¸º`new-xxx`ã€‚

  ```bash
  curl http://127.0.0.1/control/redirect/subscriber?srv=pingos&newname=new-xxx
  ```

---

ä»¥ä¸Šæ˜¯å¯¹publisherï¼ˆæ¨æµä¼šè¯ï¼‰è¿›è¡Œæ“ä½œçš„ï¼Œå¦‚æœä½ å¸Œæœ›æ“ä½œsubscriberï¼ˆæ‹‰æµä¼šè¯ï¼‰ï¼Œåˆ™åªéœ€å°†urlé‡Œçš„publisheræ›¿æ¢æˆsubscriberå³å¯ã€‚ 
{:.info}
^

`å¦‚æœä½ å¸Œæœ›ç²¾ç¡®åœ°æ“ä½œæŸä¸€è·¯æ‹‰æµä¼šè¯ï¼Œåˆ™å¯ä»¥å°†publisheræ›¿æ¢æˆclientï¼Œç„¶ååœ¨å‚æ•°é‡ŒæŒ‡å®šclientidçš„å€¼å³å¯ã€‚ ä¾‹å¦‚ï¼šä½ å¸Œæœ›æš‚åœclientidç­‰äº123çš„ä¸€è·¯ä¼šè¯ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ“ä½œğŸ‘‡`{:.info}

```bash
curl http://127.0.0.1/control/pause/publisher?srv=pingos&app=live&clientid=123
```

clientidå¯é€šè¿‡æ¥æ”¶on_playé€šçŸ¥æ¶ˆæ¯è·å–ã€‚è¯¦æƒ…è¯·æŸ¥é˜…[äº‹ä»¶é€šçŸ¥](./config-notify)